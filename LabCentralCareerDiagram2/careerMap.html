<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .active {
            stroke: #000;
            stroke-width: 2px;
        }

        body {
            -moz-user-select: none;
            -khtml-user-select: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .tooltip .tooltiptext::after {
        content: " ";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: black transparent transparent transparent;
    }
    #jobBox{
        padding: 25px !important;

    }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>

</body>
<script>


    const width = 1200;
    const height = 800;
    const body = d3.select("body");
    var wrapper = body.append("div")
        .attr("id","wrapper");
    var svg = d3.select("body")
        .append("svg")
        .attr("width", width)
        .attr("height", height);
    let currentSource = null;




    const data = {
        segments:
            [
                {
                    name: "Venture Capital / Business Development-A",
                    color: "#00a0a0"
                },
                {
                    name: "Research & Design-A",
                    color: "#a00000"
                },
                {
                    name: "Biomanufacturing-A",
                    color: "#1fb75c"
                },
                {
                    name: "Lab Administration / Lab Operations-A",
                    color: "#e8b923"
                },
                {
                    name: "Venture Capital / Business Development-M",
                    color: "#008080"
                },
                {
                    name: "Research & Design-M",
                    color: "#800000"
                },
                {
                    name: "Biomanufacturing-M",
                    color: "#2ea85f"
                },
                {
                    name: "Lab Administration / Lab Operations-M",
                    color: "#d4af37"
                },
                {
                    name: "Venture Capital / Business Development-E",
                    color: "#0d7373"
                },
                {
                    name: "Research & Design-E",
                    color: "#730d0d"
                },
                {
                    name: "Biomanufacturing-E",
                    color: "#3a9c61"
                },
                {
                    name: "Lab Administration / Lab Operations-E",
                    color: "#c4a747"
                },
            ],
        careerPaths: [
            {
                name: "Venture Capital / Business Development",
                posX: 0,
                posY: 0
            },
            {
                name: "Research & Design",
                posX: 0,
                posY: 0
            },
            {
                name: "Biomanufacturing",
                posX: 0,
                posY: 0
            },
            {
                name: "Lab Administration / Lab Operations",
                posX: 0,
                posY: 0
            }
        ],
        careerStage: [
            {
                name: "Advanced",
                posX: 0,
                posY: 0
            },
            {
                name: "Middle",
                posX: 0,
                posY: 0
            },
            {
                name: "Entry",
                posX: 0,
                posY: 0
            }

        ],
        jobs: [
            //Test Position
            {
                name: "Research Intern",
                posX: 370,
                posY: 700,
                width: 0,
                height: 0,
                neighbor: ["Research Associate", "Venture Capital Associate", "Biomenufacturing Associate"]//0 | 1 2 3
                ,
                salary: "$25/y",
                eduReq: "High School Diploma",
                eduDes: "Bachelors in Science",
                reqExp: "Beat Super Mario",
                desExp: "Beat Super Mario 2"


            },
            {
                name: "Research Associate",
                posX: 370,
                posY: 500,
                width: 0,
                height: 0,
                neighbor: []
                ,
                salary: "$25/y",
                eduReq: "High School Diploma",
                eduDes: "Bachelors in Science",
                reqExp: "Beat Super Mario",
                desExp: "Beat Super Mario 2"
                //neighbor: ["Venture Capital Associate"]
            },
            {
                name: "Venture Capital Associate",
                posX: 70,
                posY: 500,
                width: 0,
                height: 0,
                neighbor: []
                ,
                salary: "$25/y",
                eduReq: "High School Diploma",
                eduDes: "Bachelors in Science",
                reqExp: "Beat Super Mario",
                desExp: "Beat Super Mario 2"
                //neighbor: ["Biomenufacturing Associate"]
            },
            {
                name: "Biomenufacturing Associate",
                posX: 630,
                posY: 500,
                width: 0,
                height: 0,
                neighbor: []
                ,
                salary: "$25/y",
                eduReq: "High School Diploma",
                eduDes: "Bachelors in Science",
                reqExp: "Beat Super Mario",
                desExp: "Beat Super Mario 2"
                //neighbor: ["Research Intern"]
            },
            {
                name: "Biomenufacturing CEO",
                posX: 630,
                posY: 200,
                width: 0,
                height: 0,
                neighbor: []
                ,
                salary: "$25/y",
                eduReq: "High School Diploma",
                eduDes: "Bachelors in Science",
                reqExp: "Beat Super Mario",
                desExp: "Beat Super Mario 2"
            }
            // Venture Capital / Business Development Positions
            //Entry
            ,{
                name: "Management Consultant(entry-level)",
                posX: 40,
                posY: 700,
                width: 0,
                height: 0,
                neighbor: []
                ,
                salary: "N/A",
                eduReq: "Bachelor's Degree",
                eduDes: "Master's or PhD preferred",
                reqExp: "None",
                desExp: "Often hired right out of college"
            }
            //Mid
            ,{
                name: "Analyst",
                posX: 50,
                posY: 450,
                width: 0,
                height: 0,
                neighbor: []
                ,
                salary: "N/A",
                eduReq: "Bachelor's Degree",
                eduDes: "MBA or PhD",
                reqExp: "Early stage diligence or scouting experience",
                desExp: "Experience in external innovation sourcing and evaluating"
            }
            ,{
                name: "Management Consultant(mid-level)",
                posX: 40,
                posY: 450,
                width: 0,
                height: 0,
                neighbor: []
                ,
                salary: "N/A",
                eduReq: "Bachelor's Degree",
                eduDes: "Master's or PhD or MD preferred",
                reqExp: "Consulting/Biotech/Pharma or startup experience preferred",
                desExp: "Experience in external innovation sourcing and evaluating"
            }
            ,{
                name: "Research Director (Biotech or Pharma)",
                posX: 30,
                posY: 400,
                width: 0,
                height: 0,
                neighbor: []
                ,
                salary: "N/A",
                eduReq: "Bachelor's Degree",
                eduDes: "Master's or PhD or MD preferred",
                reqExp: "Leading research",
                desExp: "Having scientific publications and track record of interesting research that translates to potential products"
            }
            ,{
                name: "Business Development Scout",
                posX: 60,
                posY: 350,
                width: 0,
                height: 0,
                neighbor: []
                ,
                salary: "N/A",
                eduReq: "Bachelor's Degree",
                eduDes: "Master'r or PhD preferred",
                reqExp: "Understanding of biotech or pharma",
                desExp: "Scouting experience preferred"
            }
            //Advanced
            ,{
                name: "Principal or Associate",
                posX: 80,
                posY: 250,
                width: 0,
                height: 0,
                neighbor: []
                ,
                salary: "N/A",
                eduReq: "MBA, PhD or MD usually required",
                eduDes: "MBA, PhD or MD usually required",
                reqExp: "Sourcing and supporting scientific diligence and several years of experience in VC",
                desExp: "Board experience desired but not required"
            }
            ,{
                name: "Venture Capitalist Partner",
                posX: 70,
                posY: 200,
                width: 0,
                height: 0,
                neighbor: []
                ,
                salary: "N/A",
                eduReq: "MBA, PhD or MD usually required",
                eduDes: "MBA, PhD or MD usually required",
                reqExp: "Successful portfolio of investments",
                desExp: "Board experience required.  Connections for fundraising "
            }
            ,{
                name: "Business Director Transaction Lead",
                posX: 40,
                posY: 150,
                width: 0,
                height: 0,
                neighbor: []
                ,
                salary: "N/A",
                eduReq: "Bachelor's Degree",
                eduDes: "MBA, PhD or MD preferred",
                reqExp: "BD experience",
                desExp: "Understanding of biotech or pharma"
            }



        ],
        links: [
            {
                source: 0,
                target: 1
            },
            {
                source: 0,
                target: 2
            },
            {
                source: 0,
                target: 3
            }

        ]
    }

    const dataSegments = svg.selectAll("segment").data(data.segments);
    const dataTopLabel = svg.selectAll("tLabel").data(data.careerPaths);
    const dataSideLabel = svg.selectAll("sLabel").data(data.careerStage);
    const dataJobs = svg.selectAll("job").data(data.jobs);
    const dataLinks = svg.selectAll("link").data(data.links);
    let globaLaneWidth;
    let globalLaneHeight;

    function jobsCreation() {
        let currentGElement = null;
        let enteringText = dataJobs
            .enter()
            .append("g")
            .attr("x", function (d) { return d.posX })
            .attr("y", function (d) { return d.posY })
            .attr("id", "job")
            .attr("class", function (d) { return d.name.split(" ").join("") })
            .append("text")
            .attr("x", function (d) { return d.posX })
            .attr("y", function (d) { return d.posY })
            .attr("id", "jobText")
            .text(function (d) { return d.name })
            .each(function (d) {
                let currnetText = d3.select(this);
                let objectToAppend = d3.select(this.parentNode);
                let padding  = 20;
                let bbox = objectToAppend.node().getBBox();
                objectToAppend.append("rect")
                    .attr("x", bbox.x-(padding/2))
                    .attr("y", bbox.y-(padding/2))
                    .attr("width", function (d) { d.width = bbox.width; return bbox.width+padding })
                    .attr("height", function (d) { d.height = bbox.height; return bbox.height+padding })
                    .attr("rx",6)
                    .attr("ry",6)
                    .attr("id", "jobBox")
                    .style("fill", "white")
                    .style("stroke", "black")
                    .style("stroke-width", "1.5px")



            })
            .raise();
        d3.selectAll("#job")
            .on("click", generateLinks);







    }
    function generateLinks() {
        let source = null;
        for (let x = 0; x < data.jobs.length; x++) {
            if (data.jobs[x].name == this.children[1].innerHTML) {//get the second child element this will ALWAYS be the text element
                source = x;
            }

        }
        lineCreation(source);
        d3.selectAll("#job").raise();


    };
    function lineCreation(source) {
        currentSource = source;
        console.log("clicked");
        svg.selectAll("#jobBox").style("fill", "white");
        svg.selectAll("#jobBox").style("opacity", "0.3");
        svg.selectAll("#jobText").style("opacity", "0.3");
        svg.selectAll("line").remove();
        let sourceX = null;
        let sourceY = null;
        let targetX = null;
        let targetY = null;

        let sourceFound = false;
        let entering = dataLinks
            .enter()
            .each(function (d) {
                const objectToAppend = d3.select(this);
                if (d.source == source) {

                    sourceX = (data.jobs[d.source].posX + (data.jobs[d.source].width / 2));
                    sourceY = (data.jobs[d.source].posY - (data.jobs[d.source].height / 2) - 1);
                    targetX = (data.jobs[d.target].posX + (data.jobs[d.target].width / 2));
                    targetY = (data.jobs[d.target].posY - (data.jobs[d.target].height / 2));
                }
                objectToAppend.append("line")
                    .attr("class", "link")
                    .attr("x1", sourceX)
                    .attr("y1", sourceY)
                    .attr("x2", sourceX)
                    .attr("y2", sourceY)
                    .attr("stroke-width", "3px")
                    .attr("stroke", "white")
                    .attr("fill", "none")
                    .transition()
                    .duration(1500)
                    .attr("x2", targetX)
                    .attr("y2", targetY);

            });


        selectedNodes();

    }
    function swimingLaneCreation(vertLaneNum, horiLaneNum) {
        let currentPosX = 0;
        let currentPosY = 50;
        const laneWidth = (width - 80) / vertLaneNum;
        const laneHeight = (height - 80) / horiLaneNum;
        globaLaneWidth = laneWidth;
        globalLaneHeight = laneHeight;
        const numOfLanes = vertLaneNum * horiLaneNum;
        let modeCounter = horiLaneNum;
        const firstRowHeight = laneHeight + 50;
        const firstColumnWidth = laneWidth + 50;
        let entering = dataSegments
            .enter()
            .append("rect")
            .attr("x", function (a, i) {
                if (i == 0) {
                    return currentPosX;
                }
                else if (i % vertLaneNum == 0) {
                    currentPosX = 0;
                    return currentPosX;
                }
                else {
                    currentPosX += laneWidth;
                    return currentPosX;
                }
            })
            .attr("y", function (a, i) {
                if (i == 0) {
                    return currentPosY;
                }
                else if (i % vertLaneNum == 0) {
                    currentPosY += laneHeight;

                    return currentPosY;
                }
                else {
                    return currentPosY;
                }
            })
            .attr("width", `${laneWidth}`)
            .attr("height", `${laneHeight}`)
            .attr("fill", function (d) {
                return d.color;
            })
            .attr("stroke-width", "2px")
            .attr("stroke", "black")
            .attr("id", "diagram");
    };
    function topLabels() {
        let currentPosX = 0;
        const currentPosY = 0;
        let currentWidth = globaLaneWidth;
        const currentHeight = 50;



        let entering = dataTopLabel
            .enter()
            .append("g")
            .attr("class", "careerLabel")
            .attr("id", "diagram")
            .attr("class", "careerLabel");

        entering.append("rect")
            .attr("x", function (d, i) {
                if (i == 0) {
                    d.posY = currentPosY;
                    d.posX = currentPosX;
                    return currentPosX;
                }
                else {
                    currentPosX += currentWidth;
                    d.posX = currentPosX;
                    return currentPosX;
                }
            })
            .attr("y", currentPosY)
            .attr("width", currentWidth)
            .attr("height", currentHeight)
            .attr("fill", "white")
            .attr("stroke-width", "2px")
            .attr("stroke", "black")

        entering
            .append("text")
            .text(function (d) { return d.name })
            .attr("x", function (d, i) { return d.posX })
            .attr("y", 25)

        d3.selectAll(".careerLabel")
    }
    function sideLabel() {
        const currentPosX = width - 80;
        let currentPosY = 50;
        const currentHeight = globalLaneHeight;
        const currentWidth = 50;
        let entering = dataSideLabel
            .enter()
            .append("g")
            .attr("class", "careerLabel")
            .attr("id", "diagram")
            .attr("class", "careerLabel");

        entering.append("rect")
            .attr("x", currentPosX)
            .attr("y", function (d, i) {
                if (i == 0) {
                    d.posY = currentPosY;
                    return currentPosY;
                }
                else {
                    currentPosY += globalLaneHeight;
                    d.posY = currentPosY;
                    return currentPosY;
                }
            })
            .attr("width", currentWidth)
            .attr("height", globalLaneHeight)
            .attr("fill", "white")
            .attr("stroke-width", "2px")
            .attr("stroke", "black");

        entering.append("text")
            .text(function (d) { return d.name })
            .attr("transform", function (d) { return `translate(${1130},${d.posY + 50}) rotate(90)` })
    }
    svg.append("rect")
        .attr("width", "100%")
        .attr("height", "100%")
        .attr("fill", "grey")
        .attr("stroke-width", "6px")
        .attr("stroke", "black");
    swimingLaneCreation(4, 3);
    topLabels();
    sideLabel();

    jobsCreation();


    d3.selectAll("#job").raise();



    svg.selectAll("#diagram")
        .attr("transform", "translate(15,15)")

    function linkRemoval() {
        svg.selectAll("line").remove();
        svg.selectAll("#jobBox").style("fill", "white");
        svg.selectAll("#jobBox").style("opacity", "1.0");
        svg.selectAll("#jobText").style("opacity", "1.0");
    }
    d3.selectAll("#diagram").on("click", linkRemoval);
    function selectedNodes() {
        let test = dataLinks
            .enter()
            .each(function (d, i) {
                if (d.source == currentSource) {
                    let sourceNode = d3.select(`.${data.jobs[currentSource].name.split(" ").join("")}`).select("rect").style("fill", "skyblue").style("opacity", "1.0");
                    let targetNodes = d3.select(`.${data.jobs[d.target].name.split(" ").join("")}`).select("rect").style("fill", "PaleVioletRed").style("opacity", "1.0");

                    let sourceText = d3.select(`.${data.jobs[currentSource].name.split(" ").join("")}`).select("text").style("opacity", "1.0");
                    let targetText = d3.select(`.${data.jobs[d.target].name.split(" ").join("")}`).select("text").style("opacity", "1.0");
                }
            });
    };
    // var tooltip = d3.selectAll("#job")
    //     .append("div")
    //     .style("position","absolute")
    //     .style("text-align","center")
    //     .attr("width","60px")
    //     .attr("height","28px")
    //     .style("background","#a60094")
    //     .style("border","solid")
    //     .style("border-width","3px")
    //     .style("border-radius", "8px")
    //     .style("padding","10px")
    //     .style("opacity",0.9)
    //     .html("<p>Hello D3 JS</p>")
    //     .raise();

    const tooltip = d3.select("body")
        .append("div")
        .style("position","absolute")
        .attr("class", "tooltip")
        .style("opacity", 0)
        .style("background-color","cornsilk")
        .style("border","solid 3px black")
        .style("border-radius","5px")
        .style("padding", "5px")
        .style("max-width","250px")
        .style("viibility","hidden")
        // .append("p")
        // .text("My name is Daniel i work at lab central and do front end web development")
        .html("<h3>Hello</h3><hr><p>My name is Daniel i work at lab central and do front end web development</p>")
        //.attr("class","tooltiptext")
        .style("text-align","center");


    let jobs = d3.selectAll("#job")
        .on("mouseover", function (d) 
        {  
            //console.log(data.jobs);
            console.log(d.path[1]);
            tooltip.html(`<h3>${d.name}</h3><hr><p>My name is Daniel i work at lab central and do front end web development</p>`)
            tooltip.transition()
            .duration(1000)
            .style("opacity",1);
            //.style("visibility","visible");
        })
        .on("mousemove",function(event){
            //console.log(event.pageX);
            let toolTipBox = document.querySelector(".tooltip");

            let currentWidth = toolTipBox.offsetWidth;
            let currentHeight = toolTipBox.offsetHeight;
            tooltip.style("top",`${event.pageY-(currentHeight + currentHeight/8)}px`)
            .style("left",`${event.pageX-(currentWidth/2)}px`);


        })
        .on("mouseout", function () 
        {  
            tooltip.transition()
            .duration(1000)
            .style("opacity",0);
            //.style("visibility","hidden");
        });






</script>

</html>