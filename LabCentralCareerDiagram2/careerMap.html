<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .active {
            stroke: #000;
            stroke-width: 2px;
        }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>

</body>
<script>


    const width = 1200;
    const height = 800;
    var svg = d3.select("body")
        .append("svg")
        .attr("width", width)
        .attr("height", height);





    const data = {
        segments:
            [
                {
                    name: "Venture Capital / Business Development-A",
                    color: "#00a0a0"
                },
                {
                    name: "Research & Design-A",
                    color: "#a00000"
                },
                {
                    name: "Biomanufacturing-A",
                    color: "#1fb75c"
                },
                {
                    name: "Lab Administration / Lab Operations-A",
                    color: "#e8b923"
                },
                {
                    name: "Venture Capital / Business Development-M",
                    color: "#008080"
                },
                {
                    name: "Research & Design-M",
                    color: "#800000"
                },
                {
                    name: "Biomanufacturing-M",
                    color: "#2ea85f"
                },
                {
                    name: "Lab Administration / Lab Operations-M",
                    color: "#d4af37"
                },
                {
                    name: "Venture Capital / Business Development-E",
                    color: "#0d7373"
                },
                {
                    name: "Research & Design-E",
                    color: "#730d0d"
                },
                {
                    name: "Biomanufacturing-E",
                    color: "#3a9c61"
                },
                {
                    name: "Lab Administration / Lab Operations-E",
                    color: "#c4a747"
                },
            ],
        careerPaths: [
            {
                name: "Venture Capital / Business Development",
                posX: 0,
                posY: 0
            },
            {
                name: "Research & Design",
                posX: 0,
                posY: 0
            },
            {
                name: "Biomanufacturing",
                posX: 0,
                posY: 0
            },
            {
                name: "Lab Administration / Lab Operations",
                posX: 0,
                posY: 0
            }
        ],
        careerStage: [
            {
                name: "Advanced",
                posX: 0,
                posY: 0
            },
            {
                name: "Middle",
                posX: 0,
                posY: 0
            },
            {
                name: "Entry",
                posX: 0,
                posY: 0
            }

        ],
        jobs: [
            {
                name: "Research Intern",
                posX: 370,
                posY: 700,
                width: 0,
                height: 0,
                neighbor: ["Research Associate", "Venture Capital Associate", "Biomenufacturing Associate"]//0 | 1 2 3
            },
            {
                name: "Research Associate",
                posX: 370,
                posY: 500,
                width: 0,
                height: 0,
                neighbor: []
                //neighbor: ["Venture Capital Associate"]
            },
            {
                name: "Venture Capital Associate",
                posX: 70,
                posY: 500,
                width: 0,
                height: 0,
                neighbor: []
                //neighbor: ["Biomenufacturing Associate"]
            },
            {
                name: "Biomenufacturing Associate",
                posX: 630,
                posY: 500,
                width: 0,
                height: 0,
                neighbor: []
                //neighbor: ["Research Intern"]
            },
            {
                name: "Biomenufacturing CEO",
                posX: 630,
                posY: 200,
                width: 0,
                height: 0,
                neighbor: []
            }
        ],
        links: [
            {
                source: 0,
                target: 1
            },
            {
                source: 0,
                target: 2
            },
            {
                source: 0,
                target: 3
            }

        ]
    }

    const dataSegments = svg.selectAll("segment").data(data.segments);
    const dataTopLabel = svg.selectAll("tLabel").data(data.careerPaths);
    const dataSideLabel = svg.selectAll("sLabel").data(data.careerStage);
    const dataJobs = svg.selectAll("job").data(data.jobs);
    const dataLinks = svg.selectAll("link").data(data.links);
    let globaLaneWidth;
    let globalLaneHeight;

    function bBoxGenerator(text) {
        let bbox = text.node().getBBox();


        let rect = svg.append("rect")
            .attr("x", bbox.x)
            .attr("y", bbox.y)
            .attr("width", bbox.width)
            .attr("height", bbox.height)
            .attr("id", "nodeBox")
            .style("fill", "white")
            .style("stroke", "black")
            .style("stroke-width", "1.5px")
            ;
    }
    function jobsCreation() {
        let currentGElement = null;
        let enteringText = dataJobs
            .enter()
            .append("g")
            .attr("x", function (d) { return d.posX })
            .attr("y", function (d) { return d.posY })
            .attr("id", "job")
            .each(function () { console.log(this) })
            .append("text")
            .attr("x", function (d) { return d.posX })
            .attr("y", function (d) { return d.posY })
            .attr("id", "jobText")
            .text(function (d) { return d.name })
            .each(function (d) {
                console.log(this);
                let currnetText = d3.select(this);
                let objectToAppend = d3.select(this.parentNode);
                let bbox = objectToAppend.node().getBBox();
                objectToAppend.append("rect")
                    .attr("x", bbox.x)
                    .attr("y", bbox.y)
                    .attr("width", function (d) { d.width = bbox.width; return bbox.width })
                    .attr("height", function (d) { d.height = bbox.height; return bbox.height })
                    .attr("id", "jobBox")
                    .style("fill", "white")
                    .style("stroke", "black")
                    .style("stroke-width", "1.5px")



            })
            .raise();
        d3.selectAll("#job")
            .on("click", generateLinks);




        function generateLinks() {
            //console.log(this.lastChild.innerHTML);
            let source = null;
            for (let x = 0; x < data.jobs.length; x++) {
                if (data.jobs[x].name == this.lastChild.innerHTML) {
                    //console.log(data.jobs[x].neighbor.length);
                    source = x;
                }

            }
            lineCreation(source);
            d3.selectAll("#job").raise();
            //console.log("clicked!");
        }


    }
    function lineCreation(source) {
        console.log("clicked");
        svg.selectAll("line").remove();
        let sourceX = null;
        let sourceY = null;
        let targetX = null;
        let targetY = null;

        let sourceFound = false;
        let dataSet = dataLinks
            .enter()
            .each(function (d) {
                const objectToAppend = d3.select(this);
                if (d.source == source) {
                    sourceX = (data.jobs[d.source].posX + (data.jobs[d.source].width / 2));
                    sourceY = (data.jobs[d.source].posY - (data.jobs[d.source].height / 2) - 1);
                    targetX = (data.jobs[d.target].posX + (data.jobs[d.target].width / 2));
                    targetY = (data.jobs[d.target].posY - (data.jobs[d.target].height / 2));
                }

                objectToAppend.append("line")
                    // .enter()
                    //     .attr({
                    //         "x1": sourceX,
                    //         "y1": sourceY,
                    //         "x2": targetX,
                    //         "y2": targetY
                    //     });
                    .attr("class", "link")
                    .attr("x1", sourceX)
                    .attr("y1", sourceY)
                    .attr("x2", sourceX)
                    .attr("y2", sourceY)
                    .attr("stroke-width", "3px")
                    .attr("stroke", "white")
                    .attr("fill", "none")
                    .transition()
                    .duration(1500)
                    .attr("x2", targetX)
                    .attr("y2", targetY);

            })


        // .append("line")
        // .attr("class", "link")
        // let connections = dataLinks
        //     .enter()
        //     .attr({
        //         "x1": sourceX,
        //         "y1": sourceY,
        //         "x2": targetX,
        //         "y2": targetY
        //     })
        // .attr("x1", function (d) {
        //     if (d.source == source) {
        //         return (data.jobs[d.source].posX + (data.jobs[d.source].width / 2));
        //     }

        // })
        // .attr("y1", function (d) {
        //     if (d.source == source) {
        //         return (data.jobs[d.source].posY - (data.jobs[d.source].height / 2) - 1);
        //     }
        // })
        // .attr("x2", function (d) {//animation in place the line will start at is source and animate towards the target

        //     if (d.source == source) {
        //         return (data.jobs[d.source].posX + (data.jobs[d.source].width / 2));
        //     }
        //     // if (d.source == source) {
        //     //     return (data.jobs[d.target].posX + (data.jobs[d.target].width / 2))
        //     // }
        // })
        // .attr("y2", function (d) {

        //     if (d.source == source) {
        //         return (data.jobs[d.source].posY - (data.jobs[d.source].height / 2) - 1);
        //     }
        //     // if (d.source == source) {
        //     //     return (data.jobs[d.target].posY - (data.jobs[d.target].height / 2))
        //     // }
        // })
        // .transition()
        // .duration(1500)
        // .attr("x2",function(d){if (d.source == source) return (data.jobs[d.source].posX + (data.jobs[d.source].width / 2))})
        // .attr("y2",function(d){if (d.source == source) return (data.jobs[d.target].posY - (data.jobs[d.target].height / 2))})
    }
    function swimingLaneCreation(vertLaneNum, horiLaneNum) {
        let currentPosX = 0;
        let currentPosY = 50;
        const laneWidth = (width - 80) / vertLaneNum;
        const laneHeight = (height - 80) / horiLaneNum;
        globaLaneWidth = laneWidth;
        globalLaneHeight = laneHeight;
        const numOfLanes = vertLaneNum * horiLaneNum;
        let modeCounter = horiLaneNum;
        const firstRowHeight = laneHeight + 50;
        const firstColumnWidth = laneWidth + 50;
        let entering = dataSegments
            .enter()
            .append("rect")
            .attr("x", function (a, i) {
                if (i == 0) {
                    //console.log(currentPosX);
                    return currentPosX;
                }
                else if (i % vertLaneNum == 0) {
                    currentPosX = 0;
                    return currentPosX;
                }
                else {
                    currentPosX += laneWidth;
                    //console.log(currentPosX);
                    return currentPosX;
                }
            })
            .attr("y", function (a, i) {
                if (i == 0) {
                    return currentPosY;
                }
                else if (i % vertLaneNum == 0) {
                    currentPosY += laneHeight;

                    return currentPosY;
                }
                else {
                    return currentPosY;
                }
            })
            .attr("width", `${laneWidth}`)
            .attr("height", `${laneHeight}`)
            .attr("fill", function (d) {
                return d.color;
            })
            .attr("stroke-width", "2px")
            .attr("stroke", "black")
            .attr("id", "diagram");
    };
    function topLabels() {
        let currentPosX = 0;
        const currentPosY = 0;
        let currentWidth = globaLaneWidth;
        const currentHeight = 50;



        let entering = dataTopLabel
            .enter()
            .append("g")
            .attr("class", "careerLabel")
            .attr("id", "diagram")
            .attr("class", "careerLabel");

        entering.append("rect")
            .attr("x", function (d, i) {
                if (i == 0) {
                    d.posY = currentPosY;
                    d.posX = currentPosX;
                    return currentPosX;
                }
                else {
                    currentPosX += currentWidth;
                    d.posX = currentPosX;
                    return currentPosX;
                }
            })
            .attr("y", currentPosY)
            .attr("width", currentWidth)
            .attr("height", currentHeight)
            .attr("fill", "white")
            .attr("stroke-width", "2px")
            .attr("stroke", "black")

        entering
            .append("text")
            .text(function (d) { return d.name })
            .attr("x", function (d, i) { return d.posX })
            .attr("y", 25)

        d3.selectAll(".careerLabel")
    }
    function sideLabel() {
        const currentPosX = width - 80;
        let currentPosY = 50;
        const currentHeight = globalLaneHeight;
        const currentWidth = 50;
        let entering = dataSideLabel
            .enter()
            .append("g")
            .attr("class", "careerLabel")
            .attr("id", "diagram")
            .attr("class", "careerLabel");

        entering.append("rect")
            .attr("x", currentPosX)
            .attr("y", function (d, i) {
                if (i == 0) {
                    d.posY = currentPosY;
                    return currentPosY;
                }
                else {
                    currentPosY += globalLaneHeight;
                    d.posY = currentPosY;
                    return currentPosY;
                }
            })
            .attr("width", currentWidth)
            .attr("height", globalLaneHeight)
            .attr("fill", "white")
            .attr("stroke-width", "2px")
            .attr("stroke", "black");

        entering.append("text")
            .text(function (d) { return d.name })
            .attr("transform", function (d) { return `translate(${1130},${d.posY + 50}) rotate(90)` })
    }
    svg.append("rect")
        .attr("width", "100%")
        .attr("height", "100%")
        .attr("fill", "grey")
        .attr("stroke-width", "6px")
        .attr("stroke", "black");
    swimingLaneCreation(4, 3);
    topLabels();
    sideLabel();

    jobsCreation();
    d3.selectAll("#job").raise();



    svg.selectAll("#diagram")
        .attr("transform", "translate(15,15)")

    function linkRemoval() {
        svg.selectAll("line").remove();
    }
    d3.selectAll("#diagram").on("click", linkRemoval);



</script>

</html>